{"ast":null,"code":"\"use strict\";\n\nvar _toConsumableArray = require(\"C:/Users/philipslee/final panda/client/node_modules/@babel/runtime/helpers/toConsumableArray.js\").default;\nvar _classCallCheck = require(\"C:/Users/philipslee/final panda/client/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"C:/Users/philipslee/final panda/client/node_modules/@babel/runtime/helpers/createClass.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getSortedRoutes = getSortedRoutes;\nvar UrlNode = /*#__PURE__*/function () {\n  function UrlNode() {\n    _classCallCheck(this, UrlNode);\n    this.placeholder = true;\n    this.children = new Map();\n    this.slugName = null;\n    this.restSlugName = null;\n    this.optionalRestSlugName = null;\n  }\n  _createClass(UrlNode, [{\n    key: \"insert\",\n    value: function insert(urlPath) {\n      this._insert(urlPath.split('/').filter(Boolean), [], false);\n    }\n  }, {\n    key: \"smoosh\",\n    value: function smoosh() {\n      return this._smoosh();\n    }\n  }, {\n    key: \"_smoosh\",\n    value: function _smoosh() {\n      var _this = this;\n      var prefix = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '/';\n      var childrenPaths = _toConsumableArray(this.children.keys()).sort();\n      if (this.slugName !== null) {\n        childrenPaths.splice(childrenPaths.indexOf('[]'), 1);\n      }\n      if (this.restSlugName !== null) {\n        childrenPaths.splice(childrenPaths.indexOf('[...]'), 1);\n      }\n      if (this.optionalRestSlugName !== null) {\n        childrenPaths.splice(childrenPaths.indexOf('[[...]]'), 1);\n      }\n      var routes = childrenPaths.map(function (c) {\n        return _this.children.get(c)._smoosh(\"\".concat(prefix).concat(c, \"/\"));\n      }).reduce(function (prev, curr) {\n        return [].concat(_toConsumableArray(prev), _toConsumableArray(curr));\n      }, []);\n      if (this.slugName !== null) {\n        routes.push.apply(routes, _toConsumableArray(this.children.get('[]')._smoosh(\"\".concat(prefix, \"[\").concat(this.slugName, \"]/\"))));\n      }\n      if (!this.placeholder) {\n        var r = prefix === '/' ? '/' : prefix.slice(0, -1);\n        if (this.optionalRestSlugName != null) {\n          throw new Error(\"You cannot define a route with the same specificity as a optional catch-all route (\\\"\".concat(r, \"\\\" and \\\"\").concat(r, \"[[...\").concat(this.optionalRestSlugName, \"]]\\\").\"));\n        }\n        routes.unshift(r);\n      }\n      if (this.restSlugName !== null) {\n        routes.push.apply(routes, _toConsumableArray(this.children.get('[...]')._smoosh(\"\".concat(prefix, \"[...\").concat(this.restSlugName, \"]/\"))));\n      }\n      if (this.optionalRestSlugName !== null) {\n        routes.push.apply(routes, _toConsumableArray(this.children.get('[[...]]')._smoosh(\"\".concat(prefix, \"[[...\").concat(this.optionalRestSlugName, \"]]/\"))));\n      }\n      return routes;\n    }\n  }, {\n    key: \"_insert\",\n    value: function _insert(urlPaths, slugNames, isCatchAll) {\n      if (urlPaths.length === 0) {\n        this.placeholder = false;\n        return;\n      }\n      if (isCatchAll) {\n        throw new Error(\"Catch-all must be the last part of the URL.\");\n      }\n      // The next segment in the urlPaths list\n      var nextSegment = urlPaths[0];\n      // Check if the segment matches `[something]`\n      if (nextSegment.startsWith('[') && nextSegment.endsWith(']')) {\n        var handleSlug = function handleSlug(previousSlug, nextSlug) {\n          if (previousSlug !== null) {\n            // If the specific segment already has a slug but the slug is not `something`\n            // This prevents collisions like:\n            // pages/[post]/index.js\n            // pages/[id]/index.js\n            // Because currently multiple dynamic params on the same segment level are not supported\n            if (previousSlug !== nextSlug) {\n              // TODO: This error seems to be confusing for users, needs an error link, the description can be based on above comment.\n              throw new Error(\"You cannot use different slug names for the same dynamic path ('\".concat(previousSlug, \"' !== '\").concat(nextSlug, \"').\"));\n            }\n          }\n          slugNames.forEach(function (slug) {\n            if (slug === nextSlug) {\n              throw new Error(\"You cannot have the same slug name \\\"\".concat(nextSlug, \"\\\" repeat within a single dynamic path\"));\n            }\n            if (slug.replace(/\\W/g, '') === nextSegment.replace(/\\W/g, '')) {\n              throw new Error(\"You cannot have the slug names \\\"\".concat(slug, \"\\\" and \\\"\").concat(nextSlug, \"\\\" differ only by non-word symbols within a single dynamic path\"));\n            }\n          });\n          slugNames.push(nextSlug);\n        };\n        // Strip `[` and `]`, leaving only `something`\n        var segmentName = nextSegment.slice(1, -1);\n        var isOptional = false;\n        if (segmentName.startsWith('[') && segmentName.endsWith(']')) {\n          // Strip optional `[` and `]`, leaving only `something`\n          segmentName = segmentName.slice(1, -1);\n          isOptional = true;\n        }\n        if (segmentName.startsWith('...')) {\n          // Strip `...`, leaving only `something`\n          segmentName = segmentName.substring(3);\n          isCatchAll = true;\n        }\n        if (segmentName.startsWith('[') || segmentName.endsWith(']')) {\n          throw new Error(\"Segment names may not start or end with extra brackets ('\".concat(segmentName, \"').\"));\n        }\n        if (segmentName.startsWith('.')) {\n          throw new Error(\"Segment names may not start with erroneous periods ('\".concat(segmentName, \"').\"));\n        }\n        if (isCatchAll) {\n          if (isOptional) {\n            if (this.restSlugName != null) {\n              throw new Error(\"You cannot use both an required and optional catch-all route at the same level (\\\"[...\".concat(this.restSlugName, \"]\\\" and \\\"\").concat(urlPaths[0], \"\\\" ).\"));\n            }\n            handleSlug(this.optionalRestSlugName, segmentName);\n            // slugName is kept as it can only be one particular slugName\n            this.optionalRestSlugName = segmentName;\n            // nextSegment is overwritten to [[...]] so that it can later be sorted specifically\n            nextSegment = '[[...]]';\n          } else {\n            if (this.optionalRestSlugName != null) {\n              throw new Error(\"You cannot use both an optional and required catch-all route at the same level (\\\"[[...\".concat(this.optionalRestSlugName, \"]]\\\" and \\\"\").concat(urlPaths[0], \"\\\").\"));\n            }\n            handleSlug(this.restSlugName, segmentName);\n            // slugName is kept as it can only be one particular slugName\n            this.restSlugName = segmentName;\n            // nextSegment is overwritten to [...] so that it can later be sorted specifically\n            nextSegment = '[...]';\n          }\n        } else {\n          if (isOptional) {\n            throw new Error(\"Optional route parameters are not yet supported (\\\"\".concat(urlPaths[0], \"\\\").\"));\n          }\n          handleSlug(this.slugName, segmentName);\n          // slugName is kept as it can only be one particular slugName\n          this.slugName = segmentName;\n          // nextSegment is overwritten to [] so that it can later be sorted specifically\n          nextSegment = '[]';\n        }\n      }\n      // If this UrlNode doesn't have the nextSegment yet we create a new child UrlNode\n      if (!this.children.has(nextSegment)) {\n        this.children.set(nextSegment, new UrlNode());\n      }\n      this.children.get(nextSegment)._insert(urlPaths.slice(1), slugNames, isCatchAll);\n    }\n  }]);\n  return UrlNode;\n}();\nfunction getSortedRoutes(normalizedPages) {\n  // First the UrlNode is created, and every UrlNode can have only 1 dynamic segment\n  // Eg you can't have pages/[post]/abc.js and pages/[hello]/something-else.js\n  // Only 1 dynamic segment per nesting level\n  // So in the case that is test/integration/dynamic-routing it'll be this:\n  // pages/[post]/comments.js\n  // pages/blog/[post]/comment/[id].js\n  // Both are fine because `pages/[post]` and `pages/blog` are on the same level\n  // So in this case `UrlNode` created here has `this.slugName === 'post'`\n  // And since your PR passed through `slugName` as an array basically it'd including it in too many possibilities\n  // Instead what has to be passed through is the upwards path's dynamic names\n  var root = new UrlNode();\n  // Here the `root` gets injected multiple paths, and insert will break them up into sublevels\n  normalizedPages.forEach(function (pagePath) {\n    return root.insert(pagePath);\n  });\n  // Smoosh will then sort those sublevels up to the point where you get the correct route definition priority\n  return root.smoosh();\n}","map":{"version":3,"mappings":"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","names":["getSortedRoutes","UrlNode","placeholder","children","Map","slugName","restSlugName","optionalRestSlugName","insert","urlPath","_insert","split","filter","Boolean","smoosh","_smoosh","prefix","childrenPaths","keys","sort","splice","indexOf","routes","map","c","get","reduce","prev","curr","push","r","slice","Error","unshift","urlPaths","slugNames","isCatchAll","length","nextSegment","startsWith","endsWith","handleSlug","previousSlug","nextSlug","forEach","slug","replace","segmentName","isOptional","substring","has","set","normalizedPages","root","pagePath"],"sources":["../../../../../shared/lib/router/utils/sorted-routes.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}