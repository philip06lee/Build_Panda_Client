{"ast":null,"code":"\"use strict\";\n\nvar _createForOfIteratorHelper = require(\"C:/Users/philipslee/final panda/client/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\").default;\nvar _slicedToArray = require(\"C:/Users/philipslee/final panda/client/node_modules/@babel/runtime/helpers/slicedToArray.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.matchHas = matchHas;\nexports.compileNonPath = compileNonPath;\nexports.prepareDestination = prepareDestination;\nvar _extends = require(\"@swc/helpers/lib/_extends.js\").default;\nvar _pathToRegexp = require(\"next/dist/compiled/path-to-regexp\");\nvar _escapeRegexp = require(\"../../escape-regexp\");\nvar _parseUrl = require(\"./parse-url\");\n/**\n * Ensure only a-zA-Z are used for param names for proper interpolating\n * with path-to-regexp\n */\nfunction getSafeParamName(paramName) {\n  var newParamName = '';\n  for (var i = 0; i < paramName.length; i++) {\n    var charCode = paramName.charCodeAt(i);\n    if (charCode > 64 && charCode < 91 || charCode > 96 && charCode < 123 // a-z\n    ) {\n      newParamName += paramName[i];\n    }\n  }\n  return newParamName;\n}\nfunction escapeSegment(str, segmentName) {\n  return str.replace(new RegExp(\":\".concat((0, _escapeRegexp).escapeStringRegexp(segmentName)), 'g'), \"__ESC_COLON_\".concat(segmentName));\n}\nfunction unescapeSegments(str) {\n  return str.replace(/__ESC_COLON_/gi, ':');\n}\nfunction matchHas(req, has, query) {\n  var params = {};\n  var allMatch = has.every(function (hasItem) {\n    var value;\n    var key = hasItem.key;\n    switch (hasItem.type) {\n      case 'header':\n        {\n          key = key.toLowerCase();\n          value = req.headers[key];\n          break;\n        }\n      case 'cookie':\n        {\n          value = req.cookies[hasItem.key];\n          break;\n        }\n      case 'query':\n        {\n          value = query[key];\n          break;\n        }\n      case 'host':\n        {\n          var _ref = (req == null ? void 0 : req.headers) || {},\n            host = _ref.host;\n          // remove port from host if present\n          var hostname = host == null ? void 0 : host.split(':')[0].toLowerCase();\n          value = hostname;\n          break;\n        }\n      default:\n        {\n          break;\n        }\n    }\n    if (!hasItem.value && value) {\n      params[getSafeParamName(key)] = value;\n      return true;\n    } else if (value) {\n      var matcher = new RegExp(\"^\".concat(hasItem.value, \"$\"));\n      var matches = Array.isArray(value) ? value.slice(-1)[0].match(matcher) : value.match(matcher);\n      if (matches) {\n        if (Array.isArray(matches)) {\n          if (matches.groups) {\n            Object.keys(matches.groups).forEach(function (groupKey) {\n              params[groupKey] = matches.groups[groupKey];\n            });\n          } else if (hasItem.type === 'host' && matches[0]) {\n            params.host = matches[0];\n          }\n        }\n        return true;\n      }\n    }\n    return false;\n  });\n  if (allMatch) {\n    return params;\n  }\n  return false;\n}\nfunction compileNonPath(value, params) {\n  if (!value.includes(':')) {\n    return value;\n  }\n  for (var _i = 0, _Object$keys = Object.keys(params); _i < _Object$keys.length; _i++) {\n    var key = _Object$keys[_i];\n    if (value.includes(\":\".concat(key))) {\n      value = value.replace(new RegExp(\":\".concat(key, \"\\\\*\"), 'g'), \":\".concat(key, \"--ESCAPED_PARAM_ASTERISKS\")).replace(new RegExp(\":\".concat(key, \"\\\\?\"), 'g'), \":\".concat(key, \"--ESCAPED_PARAM_QUESTION\")).replace(new RegExp(\":\".concat(key, \"\\\\+\"), 'g'), \":\".concat(key, \"--ESCAPED_PARAM_PLUS\")).replace(new RegExp(\":\".concat(key, \"(?!\\\\w)\"), 'g'), \"--ESCAPED_PARAM_COLON\".concat(key));\n    }\n  }\n  value = value.replace(/(:|\\*|\\?|\\+|\\(|\\)|\\{|\\})/g, '\\\\$1').replace(/--ESCAPED_PARAM_PLUS/g, '+').replace(/--ESCAPED_PARAM_COLON/g, ':').replace(/--ESCAPED_PARAM_QUESTION/g, '?').replace(/--ESCAPED_PARAM_ASTERISKS/g, '*');\n  // the value needs to start with a forward-slash to be compiled\n  // correctly\n  return (0, _pathToRegexp).compile(\"/\".concat(value), {\n    validate: false\n  })(params).slice(1);\n}\nfunction prepareDestination(args) {\n  var query = Object.assign({}, args.query);\n  delete query.__nextLocale;\n  delete query.__nextDefaultLocale;\n  delete query.__nextDataReq;\n  var escapedDestination = args.destination;\n  for (var _i2 = 0, _Object$keys2 = Object.keys(_extends({}, args.params, query)); _i2 < _Object$keys2.length; _i2++) {\n    var param = _Object$keys2[_i2];\n    escapedDestination = escapeSegment(escapedDestination, param);\n  }\n  var parsedDestination = (0, _parseUrl).parseUrl(escapedDestination);\n  var destQuery = parsedDestination.query;\n  var destPath = unescapeSegments(\"\".concat(parsedDestination.pathname).concat(parsedDestination.hash || ''));\n  var destHostname = unescapeSegments(parsedDestination.hostname || '');\n  var destPathParamKeys = [];\n  var destHostnameParamKeys = [];\n  (0, _pathToRegexp).pathToRegexp(destPath, destPathParamKeys);\n  (0, _pathToRegexp).pathToRegexp(destHostname, destHostnameParamKeys);\n  var destParams = [];\n  destPathParamKeys.forEach(function (key) {\n    return destParams.push(key.name);\n  });\n  destHostnameParamKeys.forEach(function (key) {\n    return destParams.push(key.name);\n  });\n  var destPathCompiler = (0, _pathToRegexp).compile(destPath,\n  // we don't validate while compiling the destination since we should\n  // have already validated before we got to this point and validating\n  // breaks compiling destinations with named pattern params from the source\n  // e.g. /something:hello(.*) -> /another/:hello is broken with validation\n  // since compile validation is meant for reversing and not for inserting\n  // params from a separate path-regex into another\n  {\n    validate: false\n  });\n  var destHostnameCompiler = (0, _pathToRegexp).compile(destHostname, {\n    validate: false\n  });\n  // update any params in query values\n  for (var _i3 = 0, _Object$entries = Object.entries(destQuery); _i3 < _Object$entries.length; _i3++) {\n    var _Object$entries$_i = _slicedToArray(_Object$entries[_i3], 2),\n      key1 = _Object$entries$_i[0],\n      strOrArray = _Object$entries$_i[1];\n    // the value needs to start with a forward-slash to be compiled\n    // correctly\n    if (Array.isArray(strOrArray)) {\n      destQuery[key1] = strOrArray.map(function (value) {\n        return compileNonPath(unescapeSegments(value), args.params);\n      });\n    } else {\n      destQuery[key1] = compileNonPath(unescapeSegments(strOrArray), args.params);\n    }\n  }\n  // add path params to query if it's not a redirect and not\n  // already defined in destination query or path\n  var paramKeys = Object.keys(args.params).filter(function (name) {\n    return name !== 'nextInternalLocale';\n  });\n  if (args.appendParamsToQuery && !paramKeys.some(function (key) {\n    return destParams.includes(key);\n  })) {\n    var _iterator = _createForOfIteratorHelper(paramKeys),\n      _step;\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var key = _step.value;\n        if (!(key in destQuery)) {\n          destQuery[key] = args.params[key];\n        }\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n  }\n  var newUrl;\n  try {\n    newUrl = destPathCompiler(args.params);\n    var _newUrl$split = newUrl.split('#'),\n      _newUrl$split2 = _slicedToArray(_newUrl$split, 2),\n      pathname = _newUrl$split2[0],\n      hash = _newUrl$split2[1];\n    parsedDestination.hostname = destHostnameCompiler(args.params);\n    parsedDestination.pathname = pathname;\n    parsedDestination.hash = \"\".concat(hash ? '#' : '').concat(hash || '');\n    delete parsedDestination.search;\n  } catch (err) {\n    if (err.message.match(/Expected .*? to not repeat, but got an array/)) {\n      throw new Error(\"To use a multi-match in the destination you must add `*` at the end of the param name to signify it should repeat. https://nextjs.org/docs/messages/invalid-multi-match\");\n    }\n    throw err;\n  }\n  // Query merge order lowest priority to highest\n  // 1. initial URL query values\n  // 2. path segment values\n  // 3. destination specified query values\n  parsedDestination.query = _extends({}, query, parsedDestination.query);\n  return {\n    newUrl: newUrl,\n    destQuery: destQuery,\n    parsedDestination: parsedDestination\n  };\n}","map":{"version":3,"mappings":"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","names":["matchHas","compileNonPath","prepareDestination","getSafeParamName","paramName","newParamName","i","length","charCode","charCodeAt","escapeSegment","str","segmentName","replace","RegExp","escapeStringRegexp","unescapeSegments","req","has","query","params","allMatch","every","hasItem","value","key","type","toLowerCase","headers","cookies","host","hostname","split","matcher","matches","Array","isArray","slice","match","groups","Object","keys","forEach","groupKey","includes","compile","validate","args","assign","__nextLocale","__nextDefaultLocale","__nextDataReq","escapedDestination","destination","_extends","param","parsedDestination","parseUrl","destQuery","destPath","pathname","hash","destHostname","destPathParamKeys","destHostnameParamKeys","pathToRegexp","destParams","push","name","destPathCompiler","destHostnameCompiler","entries","strOrArray","map","paramKeys","filter","appendParamsToQuery","some","newUrl","search","err","message","Error"],"sources":["../../../../../shared/lib/router/utils/prepare-destination.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}