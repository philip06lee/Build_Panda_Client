{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useIntersection = useIntersection;\n\nvar _react = require(\"react\");\n\nvar _requestIdleCallback = require(\"./request-idle-callback\");\n\nconst hasIntersectionObserver = typeof IntersectionObserver === 'function';\nconst observers = new Map();\nconst idList = [];\n\nfunction createObserver(options) {\n  const id = {\n    root: options.root || null,\n    margin: options.rootMargin || ''\n  };\n  const existing = idList.find(obj => obj.root === id.root && obj.margin === id.margin);\n  let instance;\n\n  if (existing) {\n    instance = observers.get(existing);\n\n    if (instance) {\n      return instance;\n    }\n  }\n\n  const elements = new Map();\n  const observer = new IntersectionObserver(entries => {\n    entries.forEach(entry => {\n      const callback = elements.get(entry.target);\n      const isVisible = entry.isIntersecting || entry.intersectionRatio > 0;\n\n      if (callback && isVisible) {\n        callback(isVisible);\n      }\n    });\n  }, options);\n  instance = {\n    id,\n    observer,\n    elements\n  };\n  idList.push(id);\n  observers.set(id, instance);\n  return instance;\n}\n\nfunction observe(element, callback, options) {\n  const {\n    id,\n    observer,\n    elements\n  } = createObserver(options);\n  elements.set(element, callback);\n  observer.observe(element);\n  return function unobserve() {\n    elements.delete(element);\n    observer.unobserve(element); // Destroy observer when there's nothing left to watch:\n\n    if (elements.size === 0) {\n      observer.disconnect();\n      observers.delete(id);\n      const index = idList.findIndex(obj => obj.root === id.root && obj.margin === id.margin);\n\n      if (index > -1) {\n        idList.splice(index, 1);\n      }\n    }\n  };\n}\n\nfunction useIntersection(_ref) {\n  let {\n    rootRef,\n    rootMargin,\n    disabled\n  } = _ref;\n  const isDisabled = disabled || !hasIntersectionObserver;\n  const [visible, setVisible] = (0, _react).useState(false);\n  const [element, setElement] = (0, _react).useState(null);\n  (0, _react).useEffect(() => {\n    if (hasIntersectionObserver) {\n      if (isDisabled || visible) return;\n\n      if (element && element.tagName) {\n        const unobserve = observe(element, isVisible => isVisible && setVisible(isVisible), {\n          root: rootRef == null ? void 0 : rootRef.current,\n          rootMargin\n        });\n        return unobserve;\n      }\n    } else {\n      if (!visible) {\n        const idleCallback = (0, _requestIdleCallback).requestIdleCallback(() => setVisible(true));\n        return () => (0, _requestIdleCallback).cancelIdleCallback(idleCallback);\n      }\n    }\n  }, [element, isDisabled, rootMargin, rootRef, visible]);\n  const resetVisible = (0, _react).useCallback(() => {\n    setVisible(false);\n  }, []);\n  return [setElement, visible, resetVisible];\n}\n\nif ((typeof exports.default === 'function' || typeof exports.default === 'object' && exports.default !== null) && typeof exports.default.__esModule === 'undefined') {\n  Object.defineProperty(exports.default, '__esModule', {\n    value: true\n  });\n  Object.assign(exports.default, exports);\n  module.exports = exports.default;\n}","map":{"version":3,"mappings":"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","names":["useIntersection","hasIntersectionObserver","IntersectionObserver","observers","Map","idList","createObserver","options","id","root","margin","rootMargin","existing","find","obj","instance","get","elements","observer","entries","forEach","entry","callback","target","isVisible","isIntersecting","intersectionRatio","push","set","observe","element","unobserve","delete","size","disconnect","index","findIndex","splice","rootRef","disabled","isDisabled","visible","setVisible","useState","setElement","useEffect","tagName","current","idleCallback","requestIdleCallback","cancelIdleCallback","resetVisible","useCallback"],"sources":["../../client/use-intersection.tsx"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}